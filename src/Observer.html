<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>观察者模式</title>
</head>
<body>
    <script>
        // 观察者模式/发布订阅模式
        // 实际使用中的区别：观察者模式----是一个对象，维护一个依赖列表，当状态发生变化的时候通知依赖者；
        //                发布订阅模式----消息发布者和接收者中间有个事件中心，用来调度事件
        // 二者区别：消息会不会直接发布给订阅者，如果会就是观察者模式，如果不会就是发布订阅模式；发布订阅模式不知道对方的存在，发布订阅模式中消息接收着订阅的是某一个主题
        // 可以过滤掉其他的主题，比如订阅了主题A，但是消息发布者发布了多个主题的消息，那么接收者只能收到主题A的消息，这种过滤消息的是消息调度中心
        // 1、消息发布者
        // 2、消息订阅者
        // 3、发布消息
        // 4、接收消息





        function Observer() {
            this.funs = [];
        }
        Observer.prototype = {
            subscirbe: function(fn) {
                this.funs.push(fn);
            },
            unsubscribe: function(fn) {
                this.funs = this.funs.filter(function(item) {
                    if(item !== fn) {
                        return item;
                    }
                })
            },
            publish: function(o, thisObj) {
                var scope = thisObj || window;
                this.funs.forEach(function(item) {
                    item.call(scope, o);
                });
            }
        }
        var o = new Observer();
        var f1 = function(data) {
            console.log('f1: ' + data + ', 赶紧干活了！');
        }
        var f2 = function(data) {
            console.log('f2: ' + data + ', 找他加点工资去！');
        }
        o.subscirbe(f1);
        o.subscirbe(f2);
        setTimeout(function() {
            o.publish('Tom回来了');
        }, 2000);
        setTimeout(function() {
            o.unsubscribe(f1);
            o.publish('Tom回来了');
        }, 3000);
    </script>
</body>
</html>